generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model addresses {
  id           Int       @id @default(autoincrement())
  user_id      Int?
  title        String?   @db.VarChar(100)
  full_name    String?   @db.VarChar(150)
  phone        String?   @db.VarChar(30)
  address_line String
  city         String?   @db.VarChar(100)
  district     String?   @db.VarChar(100)
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  users        users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  orders       orders[]
}

model cart_items {
  id            Int       @id @default(autoincrement())
  user_id       Int?
  product_id    Int?
  variant_id    Int?
  quantity      Int?      @default(1)
  selected_size String?   @db.VarChar(10)
  products      products? @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  product_variants product_variants? @relation(fields: [variant_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users         users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model categories {
  id               Int          @id @default(autoincrement())
  name             String       @db.VarChar(100)
  parent_id        Int?
  created_at       DateTime?    @default(now()) @db.Timestamp(6)
  categories       categories?  @relation("categoriesTocategories", fields: [parent_id], references: [id], onUpdate: NoAction)
  other_categories categories[] @relation("categoriesTocategories")
  products         products[]
}

model favorites {
  id         Int       @id @default(autoincrement())
  user_id    Int?
  product_id Int?
  products   products? @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, product_id])
}

model order_items {
  id            Int       @id @default(autoincrement())
  order_id      Int?
  product_id    Int?
  variant_id    Int?
  quantity      Int
  price         Decimal   @db.Decimal(10, 2)
  total         Decimal   @db.Decimal(10, 2)
  selected_size String?   @db.VarChar(10)
  orders        orders?   @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  products      products? @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  product_variants product_variants? @relation(fields: [variant_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
}

model orders {
  id              Int           @id @default(autoincrement())
  order_number    String?       @unique @db.VarChar(20)
  user_id         Int?
  address_id      Int
  total_amount    Decimal       @db.Decimal(10, 2)
  discount_amount Decimal?      @default(0) @db.Decimal(10, 2)
  final_amount    Decimal       @db.Decimal(10, 2)
  status          String?       @default("PREPARING") @db.VarChar(50)
  created_at      DateTime?     @default(now()) @db.Timestamp(6)
  order_items     order_items[]
  addresses       addresses     @relation(fields: [address_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users           users?        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model payment_methods {
  id           Int       @id @default(autoincrement())
  user_id      Int?
  card_holder  String?   @db.VarChar(150)
  card_last4   String?   @db.VarChar(4)
  expiry_date  String?   @db.VarChar(7)
  provider     String?   @db.VarChar(50)
  created_at   DateTime? @default(now()) @db.Timestamp(6)
  users        users?    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model product_images {
  id         Int       @id @default(autoincrement())
  product_id Int?
  image_url  String
  is_main    Boolean?  @default(false)
  products   products? @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model products {
  id             Int              @id @default(autoincrement())
  name           String           @db.VarChar(255)
  description    String?
  price          Decimal          @db.Decimal(10, 2)
  stock          Int              @default(0)
  category_id    Int?
  created_at     DateTime?        @default(now()) @db.Timestamp(6)
  updated_at     DateTime?        @default(now()) @db.Timestamp(6)
  cart_items     cart_items[]
  favorites      favorites[]
  order_items    order_items[]
  product_images product_images[]
  product_variants product_variants[]
  categories     categories?      @relation(fields: [category_id], references: [id], onUpdate: NoAction)
}

model product_variants {
  id            Int       @id @default(autoincrement())
  product_id    Int
  size          String?   @db.VarChar(10)
  price         Decimal?  @db.Decimal(10, 2)
  stock         Int       @default(0)
  sku           String?   @unique @db.VarChar(100)
  created_at    DateTime? @default(now()) @db.Timestamp(6)
  updated_at    DateTime? @default(now()) @db.Timestamp(6)
  products      products  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  cart_items    cart_items[]
  order_items   order_items[]

  @@index([product_id])
  @@unique([product_id, size])
}

model users {
  id                        Int               @id @default(autoincrement())
  name                      String            @db.VarChar(150)
  email                     String            @unique @db.VarChar(255)
  password_hash             String
  first_order_discount_used Boolean?          @default(false)
  created_at                DateTime?         @default(now()) @db.Timestamp(6)
  addresses                 addresses[]
  cart_items                cart_items[]
  favorites                 favorites[]
  orders                    orders[]
  payment_methods           payment_methods[]
}
